import {useEffect,useRef,useState} from 'react';
export const useWS=()=>{ const wsRef=useRef(null); const [events,setEvents]=useState([]); useEffect(()=>{ const proto=location.protocol==='https:'?'wss':'ws'; const ws=new WebSocket(`${proto}://${location.host}/ws`); wsRef.current=ws; const on=(e)=>setEvents(v=>[...v, JSON.parse(e.data)]); ws.addEventListener('message', on); return ()=>{ ws.removeEventListener('message', on); ws.close(); }; },[]); const send=(o)=>{ if(wsRef.current && wsRef.current.readyState===1){ wsRef.current.send(JSON.stringify(o)); } }; return { send, events }; };
